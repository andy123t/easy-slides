%%
%% This is file `beamerthemeMetaSlides.sty',
%%
%% Copyright (c) 2022 Liutao Tian <andy123t@163.com>
%%
%% Distributable under the MIT License:
%% http://www.opensource.org/licenses/mit-license.php
%%

\ProvidesPackage{beamerthemeMetaSlides}

\mode<presentation>

\newif\if@docn\@docnfalse
\DeclareOption{cn}{\@docntrue}
\DeclareOption{en}{\@docnfalse}
\ProcessOptions\relax

%--------- Package ----------
\if@docn
\usepackage[UTF8]{ctex}
\fi
%\usepackage[english]{babel}
\usepackage{amsmath,amssymb}
\usepackage{graphicx,fancybox,mathrsfs,multirow}
\usepackage{booktabs}
\usepackage{color,xcolor}
\usepackage{tcolorbox}
\usepackage{url,hyperref}
\usepackage{tabularx,array,makecell}
\usepackage{mathtools}
\usepackage{caption}
\usepackage{tikz}
\usepackage{ifxetex}
\usepackage{calc}

\graphicspath{{./figures/}{./figure/}{./images}{/.imgage/}}

% color theme setting
\definecolor{deepblue}{rgb}{0,0.3,0.58}
\definecolor{darkblue}{rgb}{0.02,0.24,0.44}
%\definecolor{darkorange}{rgb}{0.80,0.4,0.1}
\definecolor{darkgreen}{rgb}{0.02,0.18,0.20}
\definecolor{footer}{rgb}{0.5,0.2,0.5}
\definecolor{darkred}{rgb}{0.95,0.2,0.15}
\setbeamercolor{structure}{fg=deepblue}
\setbeamercolor{alerted text}{fg=darkred}

\setbeamercolor{section in head/foot}{bg=black,fg=white}
\setbeamertemplate{section in head/foot shaded}{\color{gray}
\usebeamertemplate{section in head/foot}}
\setbeamercolor{upper separation line}{bg=darkblue}
\setbeamercolor{frametitle}{fg=structure.fg!94!black}
\setbeamercolor{title in head/foot}{bg=darkgreen,fg=black!5}
\setbeamercolor{author in head/foot}{bg=darkgreen,fg=black!5}
\setbeamercolor{date in head/foot}{bg=darkgreen,fg=black!5}
\setbeamercolor{section in toc}{fg=structure.fg}

% font style setting
\usefonttheme{serif}
\usefonttheme{professionalfonts}

\setbeamersize{text margin left=0.5cm, text margin right=0.5cm}

\setbeamertemplate{blocks}[default]
\setbeamertemplate{navigation symbols}{}

% itemize items: default (triangle), circle, square, ball
\setbeamertemplate{itemize items}[circle]

% enumerate items: default, circle, square, ball
%\setbeamertemplate{enumerate items}[circle]
%\setbeamertemplate{section in toc}[square]

%\setbeamertemplate{itemize item}{*}
%\setbeamertemplate{itemize subitem}{*}
%\setbeamertemplate{itemize subsubitem}{*}

%\setbeamertemplate{section in toc}[sections numbered]
%\setbeamertemplate{subsection in toc}[subsections numbered]
\setbeamertemplate{caption}[numbered]

% section in toc setting
\setbeamertemplate{section in toc}{
  \leavevmode\leftskip=2.5em%
  \llap{%
    \usebeamerfont*{section number projected}%
    \usebeamercolor{section number projected}%
    \begin{pgfpicture}{-1ex}{-0.1ex}{1ex}{2ex}
      %\color{structure.fg}
      \pgfpathcircle{\pgfpoint{0.1pt}{.75ex}}{1.3ex}
      \pgfusepath{fill}
      \pgftext[base]{\color{white}\inserttocsectionnumber}
    \end{pgfpicture}\kern2ex%
  }%
  \inserttocsection\par
}

%---------- beamer font setting ----------
\setbeamerfont{normal text}{family=\rmfamily}
\setbeamerfont{frametitle}{family=\rmfamily,series=\bfseries}
\setbeamerfont{framesubtitle}{family=\rmfamily,series=\bfseries}
\setbeamerfont{title}{family=\rmfamily,series=\bfseries}
\setbeamerfont{subtitle}{family=\rmfamily}
%\setbeamerfont{institute}{family=\rmfamily}
%\setbeamerfont{author}{family=\rmfamily}
%\setbeamerfont{date}{family=\rmfamily}
%\setbeamerfont{headline}{series=\bfseries}
%\setbeamerfont{footline}{series=\bfseries}
%\setbeamerfont{headline}{family=\rmfamily,series=\bfseries}
\setbeamerfont{footline}{family=\rmfamily}
\setbeamerfont{section in toc}{family=\rmfamily,series=\bfseries}
\setbeamerfont{subsection in toc}{family=\rmfamily,series=\bfseries}
\AtBeginDocument{\usebeamerfont{normal text}}
%\setbeamertemplate{theorems}[normal font]
\if@docn
\setbeamerfont{headline}{family=\sffamily\heiti}
\else
\setbeamerfont{headline}{family=\sffamily}
\fi

%---------- block setting ----------
\setbeamerfont{block title}{size=\normalsize,series=\bfseries}
%\setbeamerfont{block body}{}
\setbeamerfont{block title example}{size=\normalsize,series=\bfseries}
%\setbeamerfont{block body example}{}
\setbeamerfont{block title alert}{size=\normalsize,series=\bfseries}
%\setbeamerfont{block body alert}{}

% change the style of headline
\setbeamertemplate{headline}{
  \leavevmode%
  \begin{beamercolorbox}[ht=4.5ex]{section in head/foot}
    \vskip2pt\insertsectionnavigationhorizontal{\textwidth}{}{}\vskip2pt
    %\vskip2pt\insertnavigation{\paperwidth}\vskip2pt
  \end{beamercolorbox}
  \begin{beamercolorbox}[colsep=1.5pt]{upper separation line}\end{beamercolorbox}
}

% change the style of frametitle
\setbeamertemplate{frametitle}{%
  \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
  \@tempdima=\textwidth%
  \advance\@tempdima by\beamer@leftmargin%
  \advance\@tempdima by\beamer@rightmargin%
  \hfill%
  \begin{beamercolorbox}[wd=\paperwidth,sep=8pt,left]{frametitle}
    \usebeamerfont{frametitle}%
    \vbox{}\vskip-1.4ex%
    \if@tempswa\else\csname beamer@fteleft\endcsname\fi%
    \strut\insertframetitle\strut\par%
    {%
      \ifx\insertframesubtitle\@empty%
      \else%
      {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\strut\insertframesubtitle\strut\par}%
      \fi
    }%
    \vskip-1ex%
    \if@tempswa\else\vskip-8pt\fi
  \end{beamercolorbox}%
}

% change the style of footline
\setbeamertemplate{footline}{%
  \leavevmode%
  \begin{beamercolorbox}[wd=0.3\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{title in head/foot} ~~\insertshortauthor\ifx\insertinstitute\empty\else\expandafter
    \ifblank\expandafter{\beamer@shortinstitute}{}{~~(\insertshortinstitute)}\fi
    \hfill
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=0.4\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\centering \insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=0.3\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
    \usebeamerfont{date in head/foot}\hfill\insertshortdate{}\hfill %\kern1ex
    \makebox[3em][r]{\insertframenumber/\inserttotalframenumber}\kern2ex
  \end{beamercolorbox}%
  \vskip0pt%
}

%---------- new commands for tables ----------
\newcolumntype{P}[1]{>{\centering \arraybackslash}p{#1}}
\newcolumntype{L}{X}
\newcolumntype{C}{>{\centering \arraybackslash}X}
\newcolumntype{R}{>{\raggedleft \arraybackslash}X}

%---------- fix label spacing ----------
\def\beamer@inserttarget#1{%
  \ifbeamer@inframe%
    #1%
  \else% defer to next frame
    \expandafter\gdef\expandafter\beamer@framehypertargets
    \expandafter{\beamer@framehypertargets#1}%
  \fi%
}

%---------- define newcommand ----------
\if@docn
    \newcommand\thmname{定理}
    \newcommand\lmmname{引理}
    \newcommand\corname{推论}
    \newcommand\proname{命题}
    \newcommand\defname{定义}
    \newcommand\expname{例}
    \newcommand\pfname{证明:}
    \newcommand\solname{解:}
    \else
    \newcommand\thmname{Theorem}
    \newcommand\lmmname{Lemma}
    \newcommand\corname{Corollary}
    \newcommand\proname{Proposition}
    \newcommand\defname{Definition}
    \newcommand\expname{Example}
    \newcommand\pfname{Proof.}
    \newcommand\solname{Solution.}
\fi

%---------- theorem color ----------
\definecolor{bgcolor1}{rgb}{0.95,0.95,1}
\definecolor{lncolor1}{rgb}{0.63,0.58,0}
\definecolor{bgcolor2}{rgb}{0.95,0.95,0.95}
\definecolor{lncolor2}{rgb}{0.95,0.4,0.1}
\definecolor{bgcolor3}{rgb}{0.9,1,0.9}
\definecolor{lncolor3}{rgb}{0.3,0.3,0.3}

%---------- Theorem Setting  --------------
\usepackage[framemethod=tikz]{mdframed}
\usepackage[amsmath,thref,thmmarks,hyperref]{ntheorem}
\theorempreskipamount1.2em  % spacing before the environment
\theorempostskipamount0em  % spacing after the environment
\theorempostwork{\noindent}
\theoremstyle{plain} %break,plain,nonumberbreak
\if@docn
\theoremheaderfont{\color{structure.fg}\bfseries} %\upshape
\else
\theoremheaderfont{\color{structure.fg}\bfseries} %\upshape
\fi
\theorembodyfont{} %\itshape %\setlength{\baselineskip}{15pt}
\theoremindent0em
\theoremseparator{.\hspace{0.2em}} %if break -> add \vspace{0.2em}
\theoremnumbering{arabic}
\colorlet{thmcolor}{darkgreen}
\newmdtheoremenv[linecolor=lncolor1,middlelinewidth=0.5pt,
    roundcorner=1pt,backgroundcolor=bgcolor1,%
    innertopmargin=0.4em,innerbottommargin=0.4em,%
    innerleftmargin=5pt,innerrightmargin=5pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{theorem}%
    {\thmname}%[section]
\newmdtheoremenv[linecolor=lncolor1,middlelinewidth=0.5pt,
    roundcorner=1pt,backgroundcolor=bgcolor1,%
    innertopmargin=0.4em,innerbottommargin=0.4em,%
    innerleftmargin=5pt,innerrightmargin=5pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{corollary}%
    {\corname}%[section]
\newmdtheoremenv[linecolor=lncolor1,middlelinewidth=0.5pt,
    roundcorner=1pt,backgroundcolor=bgcolor1,%
    innertopmargin=0.4em,innerbottommargin=0.4em,%
    innerleftmargin=5pt,innerrightmargin=5pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{lemma}%
    {\lmmname}%[section]
\newmdtheoremenv[linecolor=lncolor2,middlelinewidth=0.5pt,
    roundcorner=1pt,backgroundcolor=bgcolor2,%
    innertopmargin=0.4em,innerbottommargin=0.4em,%
    innerleftmargin=5pt,innerrightmargin=5pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{proposition}%
    {\proname}%[section]
\newmdtheoremenv[linecolor=lncolor3,middlelinewidth=0.5pt,
    roundcorner=1pt,backgroundcolor=bgcolor3,%
    innertopmargin=0.4em,innerbottommargin=0.4em,%
    innerleftmargin=5pt,innerrightmargin=5pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{definition}%
    {\defname}%[section]
\newmdtheoremenv[linecolor=white,middlelinewidth=0.5pt,
    roundcorner=2pt,backgroundcolor=none,%
    innertopmargin=0em,innerbottommargin=0em,%
    innerleftmargin=0pt,innerrightmargin=0pt,%
    skipbelow=0.5em,skipabove=1em,%
    splittopskip=\topskip,ntheorem]{example}%
    {\expname}%[section]

%----- proof and solution environment -----
\newenvironment{proof}{\par{\bfseries\color{structure.fg}{\pfname}}\rmfamily~}{\par}
\newenvironment{solution}{\par{\bfseries\color{structure.fg}{\solname}}\rmfamily~}{\par}

%---------- proof symbol ----------
\newcommand{\QED}{\hfill\ensuremath{\square}}

%---------- number style of fig, tab and eqn ----------
%\numberwithin{figure}{section}
%\numberwithin{table}{section}
%\numberwithin{equation}{section}

%---------- verbatim sep ----------
\makeatletter
\preto{\@verbatim}{\topsep=2pt \partopsep=2pt}
\makeatother

%---------- caption setting ----------
\captionsetup[figure]{position=bottom,skip={6pt}}
\captionsetup[table]{position=top,skip={3pt}}

%---------- footnote not indented ----------
%\usepackage[flushmargin]{footmisc} % not indented
\addtobeamertemplate{footnote}{\hskip -1.5em}{}

%---------- adjust the spacing of the formula ----------
\AtBeginDocument{
    \setlength{\abovedisplayskip}{8pt plus 2pt minus 2pt}
    \setlength{\belowdisplayskip}{8pt plus 2pt minus 2pt}
    \setlength{\abovedisplayshortskip}{2pt}
    \setlength{\belowdisplayshortskip}{2pt}
    %\setlength{\arraycolsep}{2pt}
}

%\AtBeginSection[]{
%\begin{frame}
%  \frametitle{Outline}
%  \leftskip=1em
%  \tableofcontents[currentsection,currentsubsection,subsectionstyle=show/show/shaded]
%  \addtocounter{framenumber}{-1}
%\end{frame}
%}

%\AtBeginSection[]{
%\begin{frame}[plain]{}
%  \LARGE\centering
%  \tableofcontents[currentsection,sectionstyle=show/hide]
%  \addtocounter{framenumber}{-1}
%\end{frame}
%}

\mode
<all>

\endinput
